<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ğŸ”„ ë‹¨ì–´ ì¹˜í™˜ê¸°</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    :root {
      --bg-color: #fff; --text-color: #222; --border-color: #ccc;
      --input-bg: #f9f9f9; --btn-bg: #f0f0f0; --btn-hover-bg: #e0e0e0;
      --accent-color: #007bff; --delete-bg: #ffdddd; --delete-border: #ff9999;
      --move-bg: #eef; --move-border: #88f;
    }
    body.dark {
      --bg-color: #222; --text-color: #ddd; --border-color: #555;
      --input-bg: #333; --btn-bg: #444; --btn-hover-bg: #555;
    }
    body { 
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen-Sans, Ubuntu, Cantarell, "Helvetica Neue", sans-serif;
      max-width: 700px; margin: 40px auto; padding: 0 20px; 
      background-color: var(--bg-color); color: var(--text-color);
      transition: background-color 0.3s, color 0.3s; 
    }
    textarea, input[type="text"] { 
      width: 100%; padding: 10px; margin-bottom: 12px; font-size: 16px; 
      box-sizing: border-box; background: var(--input-bg); color: var(--text-color); 
      border: 1px solid var(--border-color); border-radius: 8px;
    }
    .pair { display: flex; flex-wrap: wrap; gap: 8px; align-items: center; margin-bottom: 8px; }
    .pair input { flex: 1 1 40%; min-width: 40%; }
    .pair button, .controls button, .theme-btn { 
      padding: 8px 12px; font-size: 14px; border: none; border-radius: 8px;
      cursor: pointer; background-color: var(--btn-bg); color: var(--text-color);
      transition: background-color 0.2s;
    }
    .pair button:hover, .controls button:hover, .theme-btn:hover { background-color: var(--btn-hover-bg); }
    .controls { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 20px; }
    .copy-btn { position: absolute; top: 8px; right: 8px; padding: 4px 8px; font-size: 12px; }
    .output-container, .input-container { position: relative; }
    #output { 
      white-space: pre-wrap; background: var(--input-bg); font-size: 16px; line-height: 1.5;
      min-height: 100px; border: 1px solid var(--border-color); padding: 10px; border-radius: 8px;
    }
    #output mark { background-color: #ffd700; color: #000; border-radius: 3px; padding: 0 2px; }
    .move-btn { background: var(--move-bg); border: 1px solid var(--move-border); }
    .delete-btn { background: var(--delete-bg); border: 1px solid var(--delete-border); }
    .header { display: flex; justify-content: space-between; align-items: center; }
    @media screen and (max-width: 500px) { .pair input { min-width:100%; flex:1 1 100%; } }
  </style>
</head>
<body>
  <div class="header">
    <h1>ğŸ”„ ë‹¨ì–´ ì¹˜í™˜ê¸°</h1>
    <button class="theme-btn" onclick="toggleDarkMode()">ğŸŒ—</button>
  </div>

  <h3>â‘  ë¬¸ì¥ ì…ë ¥</h3>
  <div class="input-container">
    <textarea id="inputText" rows="5" placeholder="ë¬¸ì¥ì„ ì…ë ¥í•˜ì„¸ìš”."></textarea>
    <button class="copy-btn" onclick="copyWithFeedback(this, 'inputText')">ë³µì‚¬</button>
  </div>

  <h3>â‘¡ ë‹¨ì–´ìŒ ê´€ë¦¬ (ì´ <span id="pairCount">0</span>ê°œ)</h3>
  <div id="wordPairs"></div>

  <div class="controls">
    <button onclick="addPair()">+ ë‹¨ì–´ìŒ ì¶”ê°€</button>
    <button onclick="replaceWords()">ğŸ”„ ë³€í™˜</button>
    <button onclick="downloadTXT()">ğŸ“¤ TXT ì €ì¥</button>
  </div>

  <h3>â‘¢ ë³€í™˜ëœ ë¬¸ì¥</h3>
  <div class="output-container">
    <div id="output"></div>
    <button class="copy-btn" onclick="copyWithFeedback(this, 'output')">ë³µì‚¬</button>
  </div>

  <script>
    const inputText = document.getElementById('inputText');
    const output = document.getElementById('output');
    const wordPairsContainer = document.getElementById('wordPairs');
    const pairCountEl = document.getElementById('pairCount');

    // --- 1. ìë™ ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸° ê¸°ëŠ¥ ---
    document.addEventListener('DOMContentLoaded', () => {
      // ë‹¤í¬ëª¨ë“œ ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸°
      if (localStorage.getItem('darkMode') === 'enabled') {
        document.body.classList.add('dark');
      }
      // ì €ì¥ëœ ë‹¨ì–´ìŒ ë¶ˆëŸ¬ì˜¤ê¸°
      const savedPairs = JSON.parse(localStorage.getItem('wordPairs')) || [];
      if (savedPairs.length > 0) {
        savedPairs.forEach(p => addPair(p.from, p.to));
      } else {
        addPair(); addPair(); // ì €ì¥ëœ ë‚´ìš©ì´ ì—†ìœ¼ë©´ ê¸°ë³¸ 2ê°œ ì¶”ê°€
      }
      updateAllCounts();
    });

    function savePairs() {
      const pairs = Array.from(document.querySelectorAll('.pair')).map(p => ({
        from: p.querySelector('.from').value,
        to: p.querySelector('.to').value,
      }));
      localStorage.setItem('wordPairs', JSON.stringify(pairs));
    }
    // --- ë: ìë™ ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸° ---

    function toggleDarkMode() {
      document.body.classList.toggle('dark');
      // ë‹¤í¬ëª¨ë“œ ìƒíƒœ ì €ì¥
      if (document.body.classList.contains('dark')) {
        localStorage.setItem('darkMode', 'enabled');
      } else {
        localStorage.removeItem('darkMode');
      }
    }

    function addPair(from = '', to = '') {
      const pair = document.createElement('div');
      pair.className = 'pair';
      pair.innerHTML = `
        <input class="from" type="text" placeholder="ì›ë³¸ ë‹¨ì–´" value="${from}">
        <input class="to" type="text" placeholder="ìˆ˜ì • ë‹¨ì–´" value="${to}">
        <span class="count">íšŸìˆ˜: 0</span>
        <button class="move-btn" onclick="moveUp(this)">â†‘</button>
        <button class="move-btn" onclick="moveDown(this)">â†“</button>
        <button class="delete-btn" onclick="deletePair(this)">âŒ</button>
      `;
      wordPairsContainer.appendChild(pair);
      pair.querySelectorAll('input').forEach(el => el.addEventListener('input', () => {
        updateAllCounts();
        savePairs();
      }));
      updateAllCounts();
    }

    function deletePair(btn) {
      btn.parentElement.remove();
      updateAllCounts();
      savePairs();
    }

    function moveUp(btn) {
      const cur = btn.parentElement, prev = cur.previousElementSibling;
      if (prev) {
        cur.parentNode.insertBefore(cur, prev);
        savePairs();
      }
    }

    function moveDown(btn) {
      const cur = btn.parentElement, nxt = cur.nextElementSibling;
      if (nxt) {
        cur.parentNode.insertBefore(nxt, cur);
        savePairs();
      }
    }

    function replaceWords() {
      let text = inputText.value;
      let displayHtml = text.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;");
      
      document.querySelectorAll('.pair').forEach(pair => {
        const from = pair.querySelector('.from').value.trim();
        const to = pair.querySelector('.to').value.trim();
        if (from) {
          const regex = new RegExp(from.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'gi');
          displayHtml = displayHtml.replace(regex, `<mark>${to}</mark>`);
        }
      });
      output.innerHTML = displayHtml;
    }

    // --- 2. ê°œì„ ëœ ë³µì‚¬ ê¸°ëŠ¥ ---
    function copyWithFeedback(btn, elementId) {
      const el = document.getElementById(elementId);
      const textToCopy = el.value !== undefined ? el.value : el.innerText;
      navigator.clipboard.writeText(textToCopy).then(() => {
        const originalText = btn.innerText;
        btn.innerText = 'âœ… ì™„ë£Œ!';
        setTimeout(() => {
          btn.innerText = originalText;
        }, 1500);
      });
    }

    function updateAllCounts() {
      pairCountEl.innerText = document.querySelectorAll('.pair').length;
      document.querySelectorAll('.pair').forEach(updateWordCount);
    }

    function updateWordCount(pair) {
      const from = pair.querySelector('.from').value.trim();
      const countEl = pair.querySelector('.count');
      if (from) {
        const regex = new RegExp(from.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'gi');
        const count = (inputText.value.match(regex) || []).length;
        countEl.innerText = `íšŸìˆ˜: ${count}`;
      } else {
        countEl.innerText = 'íšŸìˆ˜: 0';
      }
    }

    function downloadTXT() {
      const pairsText = Array.from(document.querySelectorAll('.pair'))
        .map(p => {
          const f = p.querySelector('.from').value;
          const t = p.querySelector('.to').value;
          return `${f}:${t}`; // ì›ë³¸:ìˆ˜ì • í˜•ì‹ìœ¼ë¡œ ì €ì¥
        }).join('\n');

      const blob = new Blob([pairsText], { type: 'text/plain;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'ë‹¨ì–´ìŒ.txt';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    inputText.addEventListener('input', () => {
      replaceWords();
      updateAllCounts();
    });
  </script>
</body>
</html>